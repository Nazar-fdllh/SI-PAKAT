<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dokumentasi API SI-PAKAT</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: #333; max-width: 960px; margin: 0 auto; padding: 20px; background-color: #f9f9f9; }
        h1, h2, h3 { color: #2c3e50; border-bottom: 2px solid #e0e0e0; padding-bottom: 10px; }
        h1 { font-size: 2.5em; }
        h2 { font-size: 2em; margin-top: 40px; }
        h3 { font-size: 1.5em; margin-top: 30px; border-bottom: 1px solid #e0e0e0; }
        .endpoint { background-color: #ffffff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .method { font-family: monospace; font-weight: bold; border-radius: 5px; padding: 5px 10px; color: #fff; display: inline-block; font-size: 1.1em; }
        .method.post { background-color: #28a745; }
        .method.get { background-color: #007bff; }
        .method.put { background-color: #fd7e14; }
        .method.delete { background-color: #dc3545; }
        .url { font-family: monospace; background-color: #e9ecef; padding: 5px 10px; border-radius: 5px; color: #495057; font-size: 1.1em; }
        .description { margin-top: 15px; color: #666; }
        .section-title { font-weight: bold; margin-top: 20px; color: #34495e; }
        pre { background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; }
        code { font-family: "Courier New", Courier, monospace; }
        .note { background-color: #fff3cd; border-left: 5px solid #ffeeba; padding: 15px; margin-top: 20px; }
        .note strong { color: #856404; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f2f2f2; }
        ol li { margin-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Dokumentasi API SI-PAKAT</h1>
    <p>Dokumentasi RESTful API untuk Sistem Informasi Pengelolaan Keamanan Aset TIK. Semua endpoint, kecuali login, memerlukan otorisasi menggunakan Bearer Token.</p>
    <p><strong>Base URL:</strong> <code>http://localhost:3001</code></p>

    <div class="note">
        <strong>Penting:</strong> Untuk semua request yang memerlukan autentikasi, sertakan header berikut:
        <pre><code>Authorization: Bearer <JWT_TOKEN_ANDA></code></pre>
    </div>

    <!-- ====================================================================== -->
    <!--                      AUTHENTICATION SECTION                          -->
    <!-- ====================================================================== -->
    <h2><span style="color:#6f42c1;">&#x1F511;</span> Autentikasi</h2>
    <div class="endpoint">
        <h3>Login Pengguna</h3>
        <p><span class="method post">POST</span> <span class="url">/api/auth/login</span></p>
        <p class="description">Endpoint untuk mengautentikasi pengguna dan mendapatkan token akses (JWT).</p>

        <p class="section-title">Request Body</p>
        <pre><code>{
    "email": "admin@sipakat.com",
    "password": "password123"
}</code></pre>

        <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>{
    "id": 1,
    "name": "Admin Utama",
    "email": "admin@sipakat.com",
    "role": "Administrator",
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}</code></pre>
        <p class="section-title">Kemungkinan Error</p>
        <ul>
            <li><strong>400 Bad Request:</strong> Email atau password tidak diisi.</li>
            <li><strong>401 Unauthorized:</strong> Password salah.</li>
            <li><strong>404 Not Found:</strong> Email tidak ditemukan.</li>
        </ul>
    </div>

    <!-- ====================================================================== -->
    <!--                           USERS SECTION                              -->
    <!-- ====================================================================== -->
    <h2><span style="color:#007bff;">&#x1F465;</span> Manajemen Pengguna (Hanya Admin)</h2>
    
    <div class="endpoint">
        <h3><span class="method get">GET</span> <span class="url">/api/users</span></h3>
        <p class="description">Mengambil daftar semua pengguna terdaftar.</p>
        <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>[
    {
        "id": 1,
        "name": "Admin Utama",
        "email": "admin@sipakat.com",
        "role": "Administrator"
    },
    {
        "id": 2,
        "name": "Budi Manajer",
        "email": "budi.manajer@sipakat.com",
        "role": "Manajer Aset"
    }
]</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span> <span class="url">/api/users</span></h3>
        <p class="description">Membuat pengguna baru.</p>
        <p class="section-title">Request Body</p>
        <pre><code>{
    "username": "Citra Auditor",
    "email": "citra@sipakat.com",
    "password": "newpassword123",
    "role_id": 3
}</code></pre>
        <p class="section-title">Contoh Response Sukses (201 Created)</p>
        <pre><code>{
    "id": 3,
    "username": "Citra Auditor",
    "email": "citra@sipakat.com",
    "role_id": 3
}</code></pre>
    </div>

     <div class="endpoint">
        <h3><span class="method get">GET</span> <span class="url">/api/users/{id}</span></h3>
        <p class="description">Mengambil detail satu pengguna berdasarkan ID-nya.</p>
        <p class="section-title">Parameter</p>
        <table>
            <tr><th>Nama</th><th>Tipe</th><th>Deskripsi</th></tr>
            <tr><td>id</td><td>integer</td><td>ID unik dari pengguna. Contoh: <code>/api/users/2</code></td></tr>
        </table>
        <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>{
    "id": 2,
    "name": "Budi Manajer",
    "email": "budi.manajer@sipakat.com",
    "role_id": 2
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method put">PUT</span> <span class="url">/api/users/{id}</span></h3>
        <p class="description">Memperbarui data pengguna. Password bersifat opsional.</p>
        <p class="section-title">Request Body</p>
        <pre><code>{
    "username": "Budi Hartono",
    "email": "budi.hartono@sipakat.com",
    "role_id": 2,
    "password": "newpassword456" 
}</code></pre>
        <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>{
    "message": "Pengguna berhasil diperbarui"
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method delete">DELETE</span> <span class="url">/api/users/{id}</span></h3>
        <p class="description">Menghapus pengguna dari sistem.</p>
        <p class="section-title">Contoh Response Sukses (204 No Content)</p>
        <p>Tidak ada body respons.</p>
    </div>

    <!-- ====================================================================== -->
    <!--                          ASSETS SECTION                              -->
    <!-- ====================================================================== -->
    <h2><span style="color:#28a745;">&#x1F4BB;</span> Manajemen Aset</h2>
    <div class="endpoint">
        <h3><span class="method get">GET</span> <span class="url">/api/assets</span></h3>
        <p class="description">Mengambil daftar semua aset TIK (bisa diakses oleh semua peran terautentikasi). Termasuk nilai aset terakhir.</p>
        <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>[
    {
        "id": 15,
        "asset_code": "ASET-015",
        "asset_name": "Sistem Penyimpanan Cloud Diskominfo",
        "classification_id": 4,
        "sub_classification_id": 7,
        "identification_of_existence": "Virtual",
        "location": "Data Center Diskominfo Kalsel",
        "owner": "Diskominfo",
        "category_name": "Perangkat Lunak",
        "asset_value": "Sedang"
    },
    {
        "id": 24,
        "asset_code": "ASET-024",
        "asset_name": "Server Enttron",
        "classification_id": 3,
        "sub_classification_id": 6,
        "identification_of_existence": "Fisik",
        "location": "Data Center Diskominfo Kalsel",
        "owner": "Diskominfo",
        "category_name": "Perangkat Keras",
        "asset_value": "Tinggi"
    }
]</code></pre>
    </div>
    
     <div class="endpoint">
        <h3><span class="method get">GET</span> <span class="url">/api/assets/{id}</span></h3>
        <p class="description">Mengambil detail satu aset berdasarkan ID-nya, termasuk data penilaian terakhirnya.</p>
        <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>{
    "id": 24,
    "asset_code": "ASET-024",
    "asset_name": "Server Enttron",
    "classification_id": 3,
    "sub_classification_id": 6,
    "identification_of_existence": "Fisik",
    "location": "Data Center Diskominfo Kalsel",
    "owner": "Diskominfo",
    "category_name": "Perangkat Keras",
    "asset_value": "Tinggi",
    "total_score": 13,
    "confidentiality_score": 3,
    "integrity_score": 3,
    "availability_score": 2,
    "authenticity_score": 3,
    "non_repudiation_score": 2
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method post">POST</span> <span class="url">/api/assets</span></h3>
        <p class="description">Menambah aset baru beserta penilaian awalnya (hanya Admin/Manajer Aset). `asset_code` harus diisi secara manual oleh pengguna.</p>
        <div class="note">
            <strong>Catatan:</strong> Field <code>total_score</code> dan <code>asset_value</code> tidak perlu dikirim. Keduanya akan dihitung secara otomatis oleh backend/database berdasarkan skor-skor yang diberikan.
        </div>
        <p class="section-title">Request Body</p>
        <pre><code>{
    "asset_code": "ASET-MANUAL-01",
    "asset_name": "Laptop Staff Baru",
    "classification_id": 3,
    "sub_classification_id": null,
    "identification_of_existence": "Fisik",
    "location": "Ruang Kerja Staff",
    "owner": "Divisi TI",
    "assessed_by": 2,
    "confidentiality_score": 1,
    "integrity_score": 2,
    "availability_score": 1,
    "authenticity_score": 1,
    "non_repudiation_score": 1
}</code></pre>
        <p class="section-title">Contoh Response Sukses (201 Created)</p>
        <pre><code>{
    "id": 28,
    "asset_code": "ASET-MANUAL-01",
    "asset_name": "Laptop Staff Baru",
    "classification_id": 3,
    "sub_classification_id": null,
    "identification_of_existence": "Fisik",
    "location": "Ruang Kerja Staff",
    "owner": "Divisi TI",
    "assessed_by": 2,
    "confidentiality_score": 1,
    "integrity_score": 2,
    "availability_score": 1,
    "authenticity_score": 1,
    "non_repudiation_score": 1
}</code></pre>
    </div>

    <div class="endpoint">
        <h3><span class="method put">PUT</span> <span class="url">/api/assets/{id}</span></h3>
        <p class="description">Memperbarui data dasar aset. Jika data penilaian (skor-skor) disertakan, maka backend akan membuat **catatan penilaian baru** untuk aset ini (tidak menimpa yang lama).</p>
        <p class="section-title">Request Body (Contoh 1: Hanya memperbarui data dasar)</p>
        <pre><code>{
    "asset_code": "SERVER-V2",
    "asset_name": "Server Enttron V2",
    "classification_id": 3,
    "sub_classification_id": 6,
    "identification_of_existence": "Fisik",
    "location": "Data Center Utama",
    "owner": "Divisi Infrastruktur TI"
}</code></pre>
        <p class="section-title">Request Body (Contoh 2: Memperbarui data dasar DAN menambah penilaian baru)</p>
        <pre><code>{
    "asset_code": "SERVER-V2",
    "asset_name": "Server Enttron V2",
    "classification_id": 3,
    "sub_classification_id": 6,
    "identification_of_existence": "Fisik",
    "location": "Data Center Utama",
    "owner": "Divisi Infrastruktur TI",
    "assessed_by": 1,
    "confidentiality_score": 3,
    "integrity_score": 3,
    "availability_score": 3,
    "authenticity_score": 3,
    "non_repudiation_score": 3,
    "asset_value": "Tinggi",
    "notes": "Penilaian ulang setelah upgrade hardware."
}</code></pre>
         <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>{
    "message": "Aset berhasil diperbarui dan penilaian baru telah ditambahkan."
}</code></pre>
    </div>

     <div class="endpoint">
        <h3><span class="method delete">DELETE</span> <span class="url">/api/assets/{id}</span></h3>
        <p class="description">Menghapus aset (hanya Admin/Manajer Aset). Ini juga akan menghapus semua riwayat penilaian yang terkait.</p>
         <p class="section-title">Contoh Response Sukses (204 No Content)</p>
        <p>Tidak ada body respons.</p>
    </div>

    <!-- ====================================================================== -->
    <!--                          REPORTS SECTION                             -->
    <!-- ====================================================================== -->
    <h2><span style="color:#fd7e14;">&#x1F4C4;</span> Pelaporan</h2>
    <div class="endpoint">
        <h3><span class="method get">GET</span> <span class="url">/api/reports</span></h3>
        <p class="description">Menghasilkan laporan aset dengan filter (hanya Admin/Auditor).</p>
        <p class="section-title">Query Parameters (Opsional)</p>
        <table>
            <tr><th>Nama</th><th>Tipe</th><th>Contoh Nilai</th><th>Deskripsi</th></tr>
            <tr><td>categoryId</td><td>string</td><td>`2` atau `all`</td><td>Filter berdasarkan ID kategori aset.</td></tr>
            <tr><td>asset_value</td><td>string</td><td>`Tinggi`, `Sedang`, `Rendah`, `Semua`</td><td>Filter berdasarkan nilai klasifikasi aset.</td></tr>
        </table>
        <p>Contoh URL dengan filter: <code>/api/reports?categoryId=3&asset_value=Tinggi</code></p>
        <p class="section-title">Contoh Response Sukses (200 OK)</p>
        <pre><code>[
    {
        "id": 24,
        "asset_code": "ASET-024",
        "asset_name": "Server Enttron",
        "owner": "Diskominfo",
        "category_name": "Perangkat Keras",
        "asset_value": "Tinggi"
    }
]</code></pre>
    </div>

    <!-- ====================================================================== -->
    <!--                        TESTING WITH POSTMAN                          -->
    <!-- ====================================================================== -->
    <h2><span style="color:#ff6c37;">&#x1F680;</span> Menguji API dengan Postman</h2>
    <div class="endpoint">
        <h3>Contoh: Membuat Pengguna Baru (Memerlukan Akses Admin)</h3>
        <p class="description">Karena endpoint untuk membuat pengguna baru memerlukan hak akses Administrator, Anda tidak bisa langsung memanggilnya. Anda harus login sebagai admin terlebih dahulu untuk mendapatkan token, lalu menggunakan token tersebut untuk request selanjutnya.</p>
        
        <ol>
            <li>
                <strong>Langkah 1: Login sebagai Admin</strong>
                <p>Buat request baru di Postman:</p>
                <ul>
                    <li>Metode: <span class="method post">POST</span></li>
                    <li>URL: <span class="url">http://localhost:3001/api/auth/login</span></li>
                    <li>Pilih tab <strong>Body</strong> > <strong>raw</strong> > <strong>JSON</strong>.</li>
                    <li>Masukkan body berikut:
                        <pre><code>{
    "email": "admin@sipakat.com",
    "password": "password123"
}</code></pre>
                    </li>
                </ul>
                <p>Kirim request tersebut. Anda akan mendapatkan respons yang berisi <code>accessToken</code>.</p>
                <pre><code>{
    "id": 1,
    "name": "Admin Utama",
    "email": "admin@sipakat.com",
    "role": "Administrator",
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwicm9sZSI6IkFkbWluaXN0cmF0b3IiLCJuYW1lIjoiQWRtaW4gVXRhbWEiLCJpYXQiOjE2ODc4OT..."
}</code></pre>
            </li>
            <li>
                <strong>Langkah 2: Salin <code>accessToken</code></strong>
                <p>Salin seluruh nilai dari field <code>accessToken</code> yang Anda dapatkan dari respons login.</p>
            </li>
            <li>
                <strong>Langkah 3: Buat Request "Tambah Pengguna Baru"</strong>
                <p>Buat request baru lagi di Postman:</p>
                <ul>
                    <li>Metode: <span class="method post">POST</span></li>
                    <li>URL: <span class="url">http://localhost:3001/api/users</span></li>
                    <li>Pilih tab <strong>Authorization</strong>:
                        <ul>
                            <li>Type: <strong>Bearer Token</strong></li>
                            <li>Token: Tempel (paste) <code>accessToken</code> yang sudah Anda salin di sini.</li>
                        </ul>
                    </li>
                    <li>Pilih tab <strong>Body</strong> > <strong>raw</strong> > <strong>JSON</strong>.</li>
                    <li>Masukkan data pengguna baru yang ingin Anda buat. Pastikan `role_id` sesuai (1: Administrator, 2: Manajer Aset, 3: Auditor).
                        <pre><code>{
    "username": "Pengguna Baru Dari Postman",
    "email": "postman.user@example.com",
    "password": "securepassword",
    "role_id": 3
}</code></pre>
                    </li>
                </ul>
            </li>
            <li>
                <strong>Langkah 4: Kirim Request dan Verifikasi</strong>
                <p>Kirim request "Tambah Pengguna Baru". Jika berhasil, Anda akan mendapatkan status `201 Created` dan detail pengguna yang baru saja dibuat. Anda juga bisa memverifikasi dengan memanggil <span class="method get">GET</span> <span class="url">/api/users</span> untuk melihat apakah pengguna baru tersebut sudah masuk ke dalam daftar.</p>
            </li>
        </ol>
    </div>

</body>
</html>
